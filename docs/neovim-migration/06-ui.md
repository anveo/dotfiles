# 06 -- Statusline, Colors, Visual Enhancements

## lualine.nvim (replacing vim-airline)

### Plugin spec: `lua/plugins/ui.lua`

```lua
return {
  -- Statusline
  {
    "nvim-lualine/lualine.nvim",
    dependencies = { "nvim-web-devicons" },
    event = "VeryLazy",
    opts = {
      options = {
        theme = "jellybeans",   -- or "auto" to match colorscheme
        component_separators = { left = "", right = "" },
        section_separators = { left = "", right = "" },
        globalstatus = true,     -- single statusline for all splits
      },
      sections = {
        lualine_a = { "mode" },
        lualine_b = { "branch", "diff", "diagnostics" },
        lualine_c = { { "filename", path = 1 } },  -- relative path
        lualine_x = { "encoding", "fileformat", "filetype" },
        lualine_y = { "progress" },
        lualine_z = { "location" },
      },
    },
  },

  -- Colorscheme: jellybeans.nvim
  {
    "wtfox/jellybeans.nvim",
    lazy = false,
    priority = 1000,    -- load before everything else
    config = function()
      require("jellybeans").setup({})
      vim.cmd.colorscheme("jellybeans")

      -- Port line proximity and overflow highlights
      -- These survive colorscheme changes because they're set after the scheme loads
      vim.api.nvim_set_hl(0, "ColorColumn", { bg = "#261e1e" })
      vim.api.nvim_set_hl(0, "LineProximity", { bg = "#212121" })
      vim.api.nvim_set_hl(0, "LineOverflow", { bg = "#902020" })
      vim.api.nvim_set_hl(0, "TechWordsToAvoid", { bg = "#902020", fg = "#ffffff" })

      -- Listchars visibility
      vim.api.nvim_set_hl(0, "SpecialKey", { fg = "#ffffff", bg = "#902020" })
      vim.api.nvim_set_hl(0, "NonText", { fg = "#222222" })
    end,
  },

  -- Which-key: keybinding discovery popup
  {
    "folke/which-key.nvim",
    event = "VeryLazy",
    opts = {
      -- Group labels for leader key menus
      spec = {
        { "<Leader>f", group = "find/files" },
        { "<Leader>g", group = "git" },
        { "<Leader>h", group = "hunks" },
        { "<Leader>t", group = "tabs" },
        { "<Leader>s", group = "treesitter selection" },
      },
    },
  },

  -- Indent guides
  {
    "lukas-reineke/indent-blankline.nvim",
    main = "ibl",
    event = { "BufReadPre", "BufNewFile" },
    opts = {
      indent = {
        char = "│",
      },
      scope = {
        enabled = true,     -- highlight current scope
      },
      exclude = {
        filetypes = { "help", "neo-tree", "lazy", "mason" },
      },
    },
  },

  -- Better UI for vim.ui.select and vim.ui.input
  {
    "stevearc/dressing.nvim",
    event = "VeryLazy",
    opts = {},
  },

  -- File type icons
  {
    "nvim-tree/nvim-web-devicons",
    lazy = true,
  },

  -- Color previews in code
  {
    "norcalli/nvim-colorizer.lua",
    event = { "BufReadPre", "BufNewFile" },
    config = function()
      require("colorizer").setup({
        "*",       -- highlight all files
      }, {
        css = true,
        css_fn = true,
      })
    end,
  },

  -- TODO/FIXME/HACK highlighting and searching
  {
    "folke/todo-comments.nvim",
    dependencies = { "nvim-lua/plenary.nvim" },
    event = { "BufReadPre", "BufNewFile" },
    keys = {
      { "]t", function() require("todo-comments").jump_next() end, desc = "Next TODO" },
      { "[t", function() require("todo-comments").jump_prev() end, desc = "Previous TODO" },
      { "<Leader>ft", "<cmd>TodoTelescope<CR>", desc = "Search TODOs" },
    },
    opts = {},
  },
}
```

## Colorscheme: jellybeans.nvim

`wtfox/jellybeans.nvim` is a treesitter-aware port of the classic jellybeans colorscheme. It supports:

- Treesitter highlight groups (more granular syntax highlighting)
- LSP diagnostic colors
- Integration with gitsigns, telescope, neo-tree, etc.
- True color (termguicolors)

### Porting Custom Highlights

Your `.vimrc` has custom highlight overrides (lines 148-171). These are ported in the colorscheme config above. The key ones:

| Highlight Group | Purpose | Color |
|---|---|---|
| `ColorColumn` | Column 120 marker | `#261e1e` (subtle red) |
| `LineProximity` | Characters near column 120 (116-120) | `#212121` (subtle dark) |
| `LineOverflow` | Characters past column 120 | `#902020` (red) |
| `TechWordsToAvoid` | "obviously", "basically", etc. | Red bg, white fg |
| `SpecialKey` | Visible tab/trail characters | Red bg, white fg |
| `NonText` | End-of-buffer `~` markers | `#222222` (barely visible) |

The `matchadd()` calls that use these groups are in `lua/autocmds.lua` (see [02-core-editing](02-core-editing.md)).

## which-key.nvim (New)

This is transformative for your config. You have ~50 leader key mappings. which-key shows a popup when you press `<Leader>` and pause, listing all available bindings grouped by prefix.

No old equivalent exists. After installing, press `<Leader>` and wait 300ms to see the popup.

The `desc` strings you added to keymaps in chapters 02-05 are what which-key displays. This is why we added `desc = "..."` to every `vim.keymap.set` call.

## Optional: Bonus UI Plugins

### noice.nvim (Enhanced Messages/Cmdline)

Replaces the command line and message area with floating windows. Looks great but can be opinionated. Try it after everything else is stable:

```lua
{
  "folke/noice.nvim",
  event = "VeryLazy",
  dependencies = { "MunifTanjim/nui.nvim", "rcarriga/nvim-notify" },
  opts = {
    lsp = {
      override = {
        ["vim.lsp.util.convert_input_to_markdown_lines"] = true,
        ["vim.lsp.util.stylize_markdown"] = true,
        ["cmp.entry.get_documentation"] = true,
      },
    },
  },
}
```

### deadcolumn.nvim

Progressive colorcolumn that only appears as you approach the limit. Could replace the `matchadd` proximity highlighting with a cleaner solution:

```lua
{
  "Bekaboo/deadcolumn.nvim",
  event = { "BufReadPre", "BufNewFile" },
  opts = {
    scope = "line",
    modes = { "i", "ic", "ix", "R", "Rc", "Rx", "Rv", "Rvc", "Rvx" },
  },
}
```

## Plugins Replaced

| Old Plugin | New Plugin |
|---|---|
| `vim-airline` + `vim-airline-themes` | `lualine.nvim` |
| `vim-devicons` | `nvim-web-devicons` |
| `vim-css-color` | `nvim-colorizer.lua` |
| `jellybeans+` (custom colorscheme file) | `wtfox/jellybeans.nvim` |
| `base16-vim` | Removed (unused) |
| `vim-vividchalk` | Removed (unused) |

## Airline Settings Ported

| Airline Setting | Lualine Equivalent |
|---|---|
| `laststatus=2` | `globalstatus = true` (even better -- single line for all splits) |
| Powerline symbols | `section_separators` with powerline glyphs |
| Branch symbol `⎇` → `` | Lualine `branch` component uses devicons automatically |

Your ghostty terminal with FiraCode Nerd Font already supports these glyphs.

## Checklist

- [ ] Create `lua/plugins/ui.lua` with all plugins above
- [ ] Run `:Lazy sync`
- [ ] Test: colorscheme is jellybeans (`:colorscheme` to verify)
- [ ] Test: statusline shows mode, branch, diagnostics, filename
- [ ] Test: powerline separators render correctly (no broken glyphs)
- [ ] Test: press `<Leader>` and wait -- which-key popup appears
- [ ] Test: indent guides show on indented code
- [ ] Test: `<Leader>ca` (code action) shows a nice selection UI (dressing.nvim)
- [ ] Test: hex color codes show inline color previews
- [ ] Test: `]t` / `[t` navigate TODO comments
- [ ] Test: `<Leader>ft` searches all TODOs via telescope
- [ ] Test: line overflow highlighting works past column 120
- [ ] Optional: try noice.nvim, revert if too opinionated
